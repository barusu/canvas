{"version":3,"sources":["demo/script/main.js"],"names":["Vue","component","name","template","props","data","tabID","selectValue","key","depts","dutys","groups","users","usersID","user","list","display","watch","handler","deep","methods","selectUser","i","this","search","_this","$emit","status","length","follow","_this2","id","some","u","addUser","_this3","every","push","update","_this4","index","map","select","d","tid","defaultSelect","tem","_this5","value","forEach","toggleDutys","s","cancelUser","_this6","concat","filter","toggleUser","updateValue","_this7","clearTimeout","_st","setTimeout","SDepts","SDutys","SUsers","computed","TrueTabID","t","Users","Value","mounted"],"mappings":"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","file":"main.min.js","sourcesContent":["Vue.component('o-transfer', {\n  name: 'oTransfer',\n  template: `\n  <div class=\"o-transfer\">\n    <div class=\"transfer-panel\">\n      <div class=\"tab-head\">\n        <div class=\"tab-item\" :class=\"{'select': tabID === 0}\" @click=\"tabID = 0\" v-if=\"display.depts\">\n          <span :data-num=\"SDepts.length\">部门</span>\n        </div>\n        <div class=\"tab-item\" :class=\"{'select': tabID === 1}\" @click=\"tabID = 1\" v-if=\"display.dutys\">\n          <span :data-num=\"SDutys.length\">职务</span>\n        </div>\n        <div class=\"tab-item\" :class=\"{'select': tabID === 2}\" @click=\"tabID = 2\" v-if=\"display.groups\">\n          <span>群组</span>\n        </div>\n        <div class=\"tab-item\" :class=\"{'select': tabID === 3}\" @click=\"tabID = 3\" v-if=\"display.users\">\n          <span :data-num=\"SUsers.length\">用户</span>\n        </div>\n      </div>\n      <div class=\"tab-bar\" :class=\"'seq' + TrueTabID\"></div>\n      <div class=\"tab-content\">\n        <div class=\"body-wrapper\" :class=\"'seq' + tabID\">\n          <!-- 部门列表 -->\n          <div class=\"body\">\n            <div class=\"content\">\n              <div class=\"item\" v-for=\"i in depts\" :class=\"{'select': i.select}\" v-text=\"i.name\" @click=\"i.select = !i.select\" :key=\"'deptsl' + i.id\"></div>\n            </div>\n          </div>\n          <!-- 职务-部门 列表 -->\n          <div class=\"body\">\n            <div class=\"content dutys\">\n              <div class=\"item\" v-for=\"i in dutys\" :key=\"'dutysl' + i.id\">\n                <p v-text=\"i.name\" @click=\"toggleDutys(i)\" class=\"cup\" title=\"全选 / 取消\"></p>\n                <p class=\"min-tag\"><span v-for=\"d in i.depts\" :key=\"'dutysltag' + d.id\" v-text=\"d.name\" @click=\"d.select = !d.select\" :class=\"{'select': d.select}\"></span></p>\n              </div>\n            </div>\n          </div>\n          <!-- 用户组列表 -->\n          <div class=\"body\">\n            <div class=\"content\">\n              <div class=\"item\" v-for=\"i in groups\" :class=\"{'select': i.select}\" v-text=\"i.name + ' ( ' + i.users.length + ' )'\" @click=\"i.select = !i.select\" :key=\"'groupsl' + i.id\"></div>\n            </div>\n          </div>\n          <!-- 用户列表 -->\n          <div class=\"body\">\n            <div class=\"content\">\n              <div class=\"item\" v-for=\"i in Users\" :class=\"{'select': i.select}\" @click=\"toggleUser(i)\" :key=\"'usersl' + i.id\">\n                <span v-text=\"i.name\"></span>\n                <i class=\"el-icon-star-on\" v-if=\"i.follow\" @click.stop=\"follow(i, false)\" title=\"取消常用联系人\"></i>\n                <i class=\"el-icon-star-off\" v-else @click.stop=\"follow(i, true)\" title=\"添加为常用联系人\"></i>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <slot><slot/>\n    <div class=\"transfer-panel\">\n      <!-- 搜索框（添加额外人员） -->\n      <div class=\"tab-head\">\n        <div class=\"search-select\">\n          <input type=\"text\" class=\"search\" v-model=\"key\" :class=\"{'error': key && !user, 'success': key && user}\" @keyup.enter=\"addUser\">\n          <div class=\"search-content\">\n            <div class=\"item\" v-for=\"i in list\" @click=\"selectUser(i)\">\n              <span v-text=\"i.name\" class=\"name\"></span>\n              <span v-text=\"i.dept\"></span>\n            </div>\n          </div>\n        </div>\n        <button type=\"button\" :class=\"{'disable': !user}\" @click=\"addUser\">添加</button>\n      </div>\n      <div class=\"tab-content\">\n        <div class=\"content del\">\n          <!-- 选择的部门 -->\n          <div class=\"item dept\" v-for=\"i in SDepts\" @click=\"i.select = false\" :key=\"'deptsr' + i.id\">\n            <span v-text=\"i.name\"></span>\n            <i class=\"el-icon-delete\"></i>\n          </div>\n          <!-- 选择的职务 -->\n          <div class=\"item duty\" v-for=\"i in SDutys\" :key=\"'dutysr' + i.id\">\n            <p v-text=\"i.name\"></p>\n            <p class=\"min-tag\">\n              <template v-for=\"d in i.depts\"><span class=\"select\" :key=\"d.id\" v-if=\"d.select\" v-text=\"d.name\" @click=\"d.select = false\"></span></template>\n            </p>\n          </div>\n          <!-- 选择的用户 -->\n          <div class=\"item user\" v-for=\"i in SUsers\" @click=\"cancelUser(i.id)\" :key=\"'usersr' + i.id\">\n            <span v-text=\"i.name\"></span>\n            <i class=\"el-icon-delete\"></i>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  `,\n  props: ['data', 'value'],\n  data() {\n    return {\n      tabID: -1,\n      selectValue: null,\n      key: '',\n      depts: [],\n      dutys: [],\n      groups: [],\n      users: [],\n      usersID: [],\n      user: null,\n      list: [],\n      display: {\n        \"depts\": true,\n        \"dutys\": true,\n        \"groups\": true,\n        \"users\": true\n      }\n    };\n  },\n  watch: {\n    data: 'update',\n    key: 'search',\n    dutys: {\n      handler: 'updateValue',\n      deep: true\n    }\n  },\n  methods: {\n    selectUser(i) {\n      this.user = i;\n      this.list = [];\n    },\n    search() {\n      this.$emit('search', this.key, data => {\n        if(data.status && data.users) {\n          if(data.users.length === 1) this.user = data.users[0];\n          if(data.users.length >= 1) this.list = data.users;\n        }else this.user = null;\n      });\n    },\n    follow(i, status) {\n      this.$emit('follow', {id: i.id, name: i.name, follow: status}, data => {\n        if(data.status) this.users.some(u => {\n          if(u.id == i.id) {\n            u.follow = status;\n            return true;\n          }else return false;\n        });\n      });\n    },\n    addUser() {\n      if(this.user) {\n        this.user.follow = false;\n        if(this.users.every(i => i.id != this.user.id)) this.users.push(this.user);\n        this.usersID.push(this.user.id);\n        this.key = '';\n      }\n    },\n    update() {\n      if(this.data.display) {\n        for(var i in this.display) {\n          if(this.data.display[i] === false) this.display[i] = false;\n          else this.display[i] = true;\n        }\n      }\n      const map = [\"depts\", \"dutys\", \"groups\", \"users\"];\n      map.some((i, index) => {\n        if(this.display[i]) {\n          this.tabID = index;\n          return true;\n        }\n        return false;\n      });\n      this.depts = this.data.depts.map(i => {\n        return {\n          select: false,\n          id: i.id,\n          name: i.name\n        };\n      });\n      this.dutys = this.data.dutys.map(i => {\n        return {\n          id: i.id,\n          name: i.name,\n          depts: i.depts.map(d => {\n            return {\n              id: d.id,\n              name: d.name,\n              tid: d.tid,\n              select: false\n            };\n          })\n        };\n      });\n      this.groups = this.data.groups.map(i => {\n        return {\n          id: i.id,\n          name: i.name,\n          select: false,\n          users: i.users.map(u => u.id)\n        };\n      });\n      this.users = this.data.users.map(i => ({id: i.id, name: i.name, follow: true}));\n      this.defaultSelect();\n    },\n    defaultSelect() {\n      var tem;\n      if(this.value) {\n        if(this.value.depts) {\n          tem = {};\n          this.value.depts.forEach(i => {\n            tem[i.id] = true;\n          });\n          this.depts.forEach(i => {\n            if(tem[i.id]) i.select = true;\n          });\n        }\n        if(this.value.dutys) {\n          tem = {};\n          this.value.dutys.forEach(d => {\n            d.depts.forEach(i => {\n              tem[d.id + '-' + i.id] = true;\n            });\n          });\n          this.dutys.forEach(d => {\n            d.depts.forEach(i => {\n              if(tem[d.id + '-' + i.id]) i.select = true;\n            });\n          });\n        }\n        if(this.value.users) {\n          this.value.users.forEach(u => {\n            if(this.users.every(i => i.id != u.id)) this.users.push({id: u.id, name: u.name, follow: false});\n            this.usersID.push(u.id);\n          });\n        }\n      }\n    },\n    toggleDutys(i) {\n      var s = i.depts.every(d => d.select);\n      i.depts.forEach(d => {d.select = !s;});\n    },\n    cancelUser(id) {\n      this.groups.forEach(i => {\n        if(i.select && i.users.some(u => u == id)) {\n          i.select = false;\n          this.usersID = this.usersID.concat(i.users.filter(u => u != id));\n        }\n      });\n      this.usersID = this.usersID.filter(i => i != id);\n    },\n    toggleUser(i) {\n      if(i.select) this.cancelUser(i.id);\n      else this.usersID.push(i.id);\n    },\n    updateValue() {\n      clearTimeout(this._st);\n      this._st = setTimeout(() => {\n        this.selectValue = {\n          \"depts\": this.SDepts.map(i => ({id: i.id, name: i.name})),\n          \"dutys\": this.SDutys.map(i => {\n            return {\n              id: i.id,\n              name: i.name,\n              depts: i.depts.filter(d => d.select).map(d => ({id: d.id, name: d.name, tid: d.tid}))\n            };\n          }),\n          \"users\": this.SUsers.map(i => ({id: i.id, name: i.name}))\n        };\n        this.$emit('change');\n      }, 242);\n    }\n  },\n  computed: {\n    TrueTabID() {\n      var t = this.tabID;\n      const map = [\"depts\", \"dutys\", \"groups\", \"users\"];\n      for(var i = 0; i <= this.tabID; i++) {\n        if(this.display[map[i]] === false) t--;\n      }\n      return t;\n    },\n    SDepts() {\n      this.updateValue();\n      return this.depts.filter(i => i.select);\n    },\n    SDutys() {\n      this.updateValue();\n      return this.dutys.filter(i => i.depts.some(d => d.select));\n    },\n    SUsers() {\n      this.updateValue();\n      var t = this.usersID;\n      this.groups.forEach(i => {\n        i.select && (t = t.concat(i.users));\n      });\n      return this.users.filter(i => t.some(u => u == i.id));\n    },\n    Users() {\n      var t = this.usersID;\n      this.groups.forEach(i => {\n        i.select && (t = t.concat(i.users));\n      });\n      return this.users.map(i => {\n        return {\n          id: i.id,\n          name: i.name,\n          follow: i.follow,\n          select: t.some(u => u == i.id)\n        };\n      });\n    },\n    Value() {\n      return this.selectValue;\n    }\n  },\n  mounted() {\n    this.update();\n  }\n});\n"]}