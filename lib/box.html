<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <style>
    body {
      position: absolute;
    }
    .item-content {
      width: 630px;
      height: 630px;
      position: absolute;
    }
    li {
      width: 200px;
      height: 200px;
      padding: 5px;
      display: block;
      position: relative;
      float: left;
    }
    img {
      max-width: 200px;
      max-height: 200px;
    }
  </style>
  <script src="../js/jquery.min.js"></script>
</head>
<body>
  <div class="item-content">
    <li><div class="item"><img src="../img/1.jpg" alt=""></div></li>
    <li><div class="item"><img src="../img/2.jpg" alt=""></div></li>
    <li><div class="item"><img src="../img/3.jpg" alt=""></div></li>
    <li><div class="item"><img src="../img/4.jpg" alt=""></div></li>
    <li><div class="item"><img src="../img/5.jpg" alt=""></div></li>
    <li><div class="item"><img src="../img/6.jpg" alt=""></div></li>
    <li><div class="item"><img src="../img/7.jpg" alt=""></div></li>
    <li><div class="item"><img src="../img/8.jpg" alt=""></div></li>
    <li><div class="item"><img src="../img/9.jpg" alt=""></div></li>
  </div>
</body>
<script>
  function Pointer(x,y) {
    this.x = x;
    this.y = y;
  };
  function Position(left,top) {
    this.left = left;
    this.top = top;
  };
  $('.item-content .item').each(function(i) {
    this.init = function() {
      this.box = $(this).parent();
      $(this).attr("index", i).css({
        position: 'absolute',
        left: this.box.offset().left,
        top: this.box.offset().top
      }).appendTo('.item-content');
      this.drag();
    },
    this.move = function(callback) {
      $(this).stop(true).animate({
        left: this.box.offset().left,
        top: this.box.offset().top
      },500,function() {
        if (callback) {
          callback.call(this);
        };
      });
    },
    this.collisionCheck = function() {
      var currentItem = this;
      var direction = null;
      $(this).siblings('.item').each(function() {
        if (currentItem.pointer.x > this.box.offset().left && currentItem.pointer.y > this.box.offset().top && (currentItem.pointer.x > this.box.offset().left + this.box.width()) && (currentItem.pointer.y > this.box.offset().top + this.box.height())) {
          if (currentItem.box.offset().top < this.box.offset().top) {
            direction = 'down';
          }else if (currentItem.box.offset().top > this.box.offset().top) {
            direction = 'up';
          }else { direction = 'normal';}
          this.swap(currentItem,direction);
        }
      });
    },
    this.swap = function(currentItem,direction) {
      if (this.moveing) { return false;}
      var direction = {
        normal: function() {
          var saveBox = this.box;
          this.box = currentItem.box;
          currentItem.box = saveBox;
          this.move();
          $(this).attr('index',this.box.index());
        },
        down: function() {
          var box = this.box;
          var node = this;
          var starIndex = node.box.index();
          var endIndex = currentItem.box.index();
          for(var i = endIndex; i > starIndex; i--) {
            var nextNode = $('.item-content .item[index='+(i-1)+']')[0];
            node.box = nextNode.box;
            $(node).attr("index",node.box.index());
            node.move();
            node.nextNode;
          }
          currentItem.box = box;
          $(currentItem).attr('index',box.index());
        },
        up: function() {
          var box = this.box;
          var node = this;
          var starIndex = node.box.index();
          var endIndex = currentItem.box.index();
          for(var i = starIndex; i < endIndex; i++) {
            var next1Node = $('.item-content .item[index='+(i+1)+']')[0];
            node.box = next1Node.box;
            $(node).attr("index",node.box.index());
            node.move();
            node.nex1tNode;
          }
          currentItem.box = box;
          $(currentItem).attr('index',box.index());
        }
      }
      directions[direction].call(this);
    },
    this.drag = function() {
      var oldPosition = new Position();
      var oldPointer = new Pointer();
      var isDrag = false;
      var currentItem = null;
      $(this).mousedown(function(e) {
        e.preventDefault();//去除默认事件
        oldPosition.left = $(this).Position().left;
        oldPosition.top = $(this).Position().top;
        oldPointer.x = e.clientX;
        oldPointer.y = e.clientY;
        isDrag = true;
        currentItem = this;
      });
      $(document).mousemove(function(e) {
        var currentPointer = new Pointer();
        if (!isDrag) { return false;}
        $(currentItem).css({
          'opacity':'.8',
          'z-index': 999
        });
        var left = currentItem.x - oldPointer.x + oldPosition.left;
        var top = currentItem.y - oldPointer.y + oldPosition.top;
        $(currentItem).css({
          left: left,
          top: top
        });
        currentItem.pointer = currentPointer;
        currentItem.collisionCheck();
      });
      $(document).mouseup(function() {
        if (!isDrag) { return false;}
        isDrag = false;
        currentItem.move(function() {
          $(this).css({
            'opacity': 1,
            'z-index': 0
          });
        });
      });
    }
    this.init();
  });

</script>
</html>

